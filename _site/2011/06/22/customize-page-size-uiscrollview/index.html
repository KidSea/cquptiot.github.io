<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      改变UIScrollView的分页大小 &middot; Tao Zhang
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/style.css">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><a href="https://twitter.com/ztpala" target="_blank">@ztpala</a>，关注<a href="/tag/#iOS">iOS</a>，<a href="/category/#空手道">空手道</a>，<a href="/category/#自行车">自行车</a>以及足球。</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/apps/">Apps</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/archive/">Archives</a>
        
      
    
      
    
      
        
          <a class="sidebar-nav-item" href="/category/">Categories</a>
        
      
    
      
        
      
    
      
        
      
    
      
    
      
        
          <a class="sidebar-nav-item" href="/tag/">Tags</a>
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    

    <span class="sidebar-nav-item">Version: 26 Sep 2014</span>
    <span class="sidebar-nav-item">Powered by: <a href="//jekyllrb.com">Jekyll</a>, <a href="//getpoole.com">Poole</a>
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2014. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Tao Zhang</a>
            <small>iOS, 空手道, 自行车，足球</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">改变UIScrollView的分页大小</h1>
  <span class="post-date">22 Jun 2011</span>
  <p>众所周知UIScrollView是可以分页的，只要设置如下变量：</p>

<p><code>scrollView.pagingEnabled = YES;</code></p>

<p>效果就是Photo那种一页一页的看照片。</p>

<p>默认的话，一页的尺寸就等于 <code>scrollView.bounds.size</code>，但对于iPad这种大屏幕来讲，经常会遇到需要一页要小于这个数值，比如我希望能同时看到3张照片，但又同时想slide的时候scrollView一次只移动一张照片的宽度 <code>(scrollView.bounds.size.width/3)</code>，而不是一页的大小 <code>(scrollView.bounds.size.width)</code>。</p>

<p>解决这个问题的方法就是将要显示的所有页面内容放到同一个容器view，然后在第一次slide scrollView的同时，将这个容器view向右移动两张照片的宽度，即 <code>scrollView.bounds.size.width*2/3</code>。为什么说是第一次？因为往右移动的距离也当前scrollView的contentOffset有关，简单的数学问题，不再详述。实现代码：</p>

<pre><code class="language-objc">- (void) scrollViewDidScroll:(UIScrollView *)ascrollView {
    CGFloat offset = ascrollView.contentOffset.x*2/3;
    CGAffineTransform transform = CGAffineTransformMakeTranslation(offset, 0);
    //所以这里不能简单的移动scrollView.bounds.size.width*2/3，要计算当前的contentOffset
    [containerView setTransform:transform];
}
</code></pre>

<p>别忘了设置好scrollView的delegate。另外如果是支持屏幕旋转而照片宽度又是固定显示的话，这里不能简单用 <code>contentOffset.x*2/3</code> 来计算，因为竖屏的时候显示3张照片，横屏的时候会显示3*1024/768张，此时的containerView的移动距离也要相应改变。具体可以画个几何图形计算一下。</p>

<p>在支持屏幕旋转的情况下，除了要改变移动距离外，保证当前浏览的页面在旋转后仍然在屏幕中这点很重要，你不想在竖屏时看到第五张然后一横屏直接跳到前面前面去了，至于这种情况，甚至是那种单张照片被放大了，然后旋转后当前中心点仍然保持在中心的复杂情况，请参阅去年WWDC的Session 104。</p>

<p>最后还有一个细节问题，就是当你slide到最后时，会发现有2/3页面的空白。因为当显示到倒数第三张照片的时候，最后两张是不需要再占据页面的，这里就需要在设置scrollView.</p>

<p>contentSize的时候减去两个页面的宽度，因为contentSize的宽度直接决定scrollView被分了多少页。通用代码如下：</p>

<pre><code class="language-objc">scrollView.contentSize = CGSizeMake(width*(photoCount-(photosPerpage-1)), height);
</code></pre>

<p>如果再复杂一点，可以设计成twitter for iPad那样，所有照片“堆积”在最左侧，只要计算的清楚。当然，作者也可能是搞了个自己的UIScroollView出来，就像当初tweetie的<a href="http://stackoverflow.com/questions/576764/tab-bar-controller-inside-a-navigation-controller-or-sharing-a-navigation-root-v">自定义UITabBarController</a>一样，有更好的想法欢迎留言。</p>

<h3 id="update">2012-2-6 03:08 update</h3>

<p>另外有個超簡方法，就是把 <code>scrollView</code> 的寬度設置成想要的page寬度，然後設置 <code>clipsToBounds = NO</code>。接著再定義 <code>scrollView</code> 所在的 <code>UIView</code> 的 <code>hitTest</code>：</p>

<pre><code class="language-objc">- (UIView *)hitTest:(CGPoint)point withEvent:(UIEvent *)event {
    if ([self pointInside:point withEvent:event]) {
        return _scrollView;
    }
    return nil;
}
</code></pre>

<p>如果 <code>scrollView</code> 所在的View有其他subView的話，可以用以下代碼：</p>

<pre><code class="language-objc">- (UIView *)hitTest:(CGPoint)point withEvent:(UIEvent *)event {
    UIView *child = [super hitTest:point withEvent:event];

    if (child == self) {
        return self.scrollView;
    }

    return child;
}
</code></pre>

<p><a href="http://blog.proculo.de/archives/180-Paging-enabled-UIScrollView-With-Previews.html">via</a></p>

  <div class="tags">
    <a href="https://github.com/pala/pala.github.com/edit/master/_posts/2011-06-22-customize-page-size-uiscrollview.md" class="pull-right">Edit</a> <a href="/tag/#iOS">#iOS</a> <a href="/tag/#Cocoa">#Cocoa</a> 
  </div>
</div>

<div class="pagination">
  
  <a class="pagination-item older" href="/2011/06/19/j4-cave-1">J4洞穴探险 1</a>
  
  
  <a class="pagination-item newer" href="/2011/06/25/j4-cave-2">J4 Cave 探险 2</a>
  
</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'ztpala'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"><img class="emoji" title=":punch:" alt=":punch:" src="https://assets.github.com/images/icons/emoji/beer.png" height="20" width="20" align="absmiddle"></label>

  </body>
</html>
